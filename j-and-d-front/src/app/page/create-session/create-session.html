<h1>Liste des sessions</h1>

<button *ngIf="!showForm" (click)="showForm = true" class="btn btn-light">
    Créer une session
</button>

<form *ngIf="showForm" (ngSubmit)="creer()" [formGroup]="sessionForm">
    <!-- NOM DE LA SESSION -->
    <div class="mb-3 row">
        <label for="name" class="col-sm-2 col-form-label">Nom de la session</label>
        <div class="col-sm-10">
            <input id="name" type="text" class="form-control" formControlName="name" placeholder="Nom de la session">
        </div>
    </div>
    <!-- GM connecté (lecture seule) -->
    <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Maître du jeu</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" [value]="authService.getUserLogin()" readonly>
        </div>
    </div>

    <!-- INSCRIPTIONS -->
    <div class="mb-3 row">
        <label for="inscriptions" class="col-sm-2 col-form-label">Personnages</label>
        <div class="col-sm-10">
            <select id="inscriptions" class="form-select" formControlName="inscriptions" multiple>
                <option *ngFor="let c of characters$ | async" [ngValue]="c.name">
                    {{ c.name }}
                </option>
            </select>
        </div>
    </div>


    <!-- NPCs -->
    <div class="mb-3 row">
        <label for="npcs" class="col-sm-2 col-form-label">Monstres</label>
        <div class="col-sm-10">
            <select id="npcs" class="form-select" formControlName="npcs" multiple>
                <option *ngFor="let npc of npcs$ | async" [value]="npc.name">
                    {{ npc.name }}
                </option>
            </select>
        </div>
    </div>

    <!-- BUTTONS -->
    <div class="btn-group">
        <input type="submit" [disabled]="sessionForm.invalid" [value]="editingSession ? 'Modifier' : 'Créer'"
            [class.btn-warning]="editingSession" [class.btn-success]="!editingSession" class="btn" />

        <button type="button" class="btn btn-danger" (click)="annulerEditer()">
            Annuler
        </button>
    </div>
</form>

<hr />

<!-- TABLEAU SESSIONS -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>Nom de la session</th>
            <th>Maître du jeu</th>
            <th>Personnages</th>
            <th>Monstres</th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        <tr *ngFor="let session of sessions$ | async; trackBy: trackSession">
            <td>{{ session.name }}</td>
            <td>{{ session.gmLogin }}</td>
            <td>{{ displayList(session.inscriptionCharacters) }}</td>
            <td>{{ displayList(session.npcNames) }}</td>
            <td>
                <div class="btn-group">
                    <button class="btn btn-danger" (click)="delete(session.id)">
                        Supprimer
                    </button>
                </div>
            </td>
        </tr>
    </tbody>
</table>